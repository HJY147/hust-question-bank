# 📚 HUST搜题系统 - 题库上传指南

本指南将详细说明如何向系统添加新题目。

---

## 📋 目录

1. [快速开始](#快速开始)
2. [文件命名规则](#文件命名规则)
3. [添加题目步骤](#添加题目步骤)
4. [答案文件格式](#答案文件格式)
5. [使用脚本工具](#使用脚本工具)
6. [常见问题](#常见问题)

---

## 🚀 快速开始

### 手动添加单个题目（推荐新手）

**第一步：准备题目图片**
- 格式：`png`, `jpg`, `jpeg` 等常见图片格式
- 建议尺寸：宽度 800-2000px
- 确保图片清晰，文字可读

**第二步：放入题目图片**
```
photo-search-questions/photo/题目名称.jpg
```

**第三步：创建答案文件**
```
photo-search-questions/data/answers/题目名称.txt
```

**第四步：重启服务器**
```
双击运行 "启动服务器.bat"
```

---

## 📝 文件命名规则

### 命名格式

```
<学科缩写>_<序号>.<扩展名>

示例：
- calc_001.jpg      # 高等数学第1题
- phys_002.png      # 大学物理第2题
- circuit_003.jpg   # 电路分析第3题
```

### 学科缩写对照表

| 学科 | 缩写 | 示例 |
|------|------|------|
| 高等数学 | `calc` | `calc_001.jpg` |
| 线性代数 | `linear` | `linear_001.jpg` |
| 概率论 | `prob` | `prob_001.jpg` |
| 大学物理 | `phys` | `phys_001.jpg` |
| 电路分析 | `circuit` | `circuit_001.jpg` |
| 理论力学 | `mech` | `mech_001.jpg` |
| 数据结构 | `ds` | `ds_001.jpg` |
| 计算机组成 | `co` | `co_001.jpg` |
| 操作系统 | `os` | `os_001.jpg` |
| 计算机网络 | `net` | `net_001.jpg` |

### 序号规则

- 使用3位数字，不足补0：`001`, `002`, `003`...
- 按添加顺序递增
- 同一学科题目序号连续

---

## 📂 添加题目步骤

### 方法一：手动添加（适合少量题目）

#### 1. 准备文件

```
你的题目/
├── calc_010.jpg        # 题目图片
└── calc_010_answer.txt # 答案文本（临时文件）
```

#### 2. 放置题目图片

将 `calc_010.jpg` 复制到：
```
D:\桌面\HW\photo-search-questions\photo\calc_010.jpg
```

#### 3. 创建答案文件

在以下位置创建文本文件：
```
D:\桌面\HW\photo-search-questions\data\answers\calc_010.txt
```

填写答案内容（见[答案文件格式](#答案文件格式)）

#### 4. 验证

- 重启服务器
- 搜索题目关键词或上传图片测试

---

### 方法二：批量添加（适合大量题目）

#### 1. 准备批量文件

```
题库批量导入/
├── calc_010.jpg
├── calc_010.txt
├── calc_011.jpg
├── calc_011.txt
├── phys_020.jpg
└── phys_020.txt
```

#### 2. 使用导入脚本

打开 PowerShell，进入项目目录：
```powershell
cd D:\桌面\HW\photo-search-questions
.venv\Scripts\python.exe scripts\import_questions.py "题库批量导入文件夹路径"
```

#### 3. 脚本会自动：
- ✅ 检查文件命名是否规范
- ✅ 验证图片格式是否支持
- ✅ 将图片复制到 `photo/` 目录
- ✅ 将答案复制到 `data/answers/` 目录
- ✅ 生成导入报告

---

## 📄 答案文件格式

### 基础格式

答案文件是纯文本文件（`.txt`），支持以下格式：

```text
【题目】
求函数 f(x) = x² + 2x + 1 在 x = 1 处的导数。

【答案】
f'(x) = 2x + 2
当 x = 1 时，f'(1) = 4

【解析】
1. 对 f(x) = x² + 2x + 1 求导
2. f'(x) = 2x + 2
3. 代入 x = 1，得 f'(1) = 2×1 + 2 = 4
```

### 支持的特殊格式

#### 1. 数学公式（LaTeX）

使用 `$...$` 包裹行内公式，`$$...$$` 包裹块级公式：

```text
【答案】
$$
\int_0^1 x^2 dx = \frac{1}{3}x^3 \bigg|_0^1 = \frac{1}{3}
$$

解释：根据积分公式 $\int x^n dx = \frac{x^{n+1}}{n+1} + C$
```

#### 2. 分步解答

```text
【解题步骤】
Step 1: 建立方程
根据题意，设...

Step 2: 求解方程
解得 x = ...

Step 3: 验证答案
代入原式验证...
```

#### 3. 选择题格式

```text
【答案】B

【解析】
A. 错误，因为...
B. 正确，符合...
C. 错误，因为...
D. 错误，因为...
```

### 答案文件模板

```text
【题目类型】计算题/证明题/选择题/填空题

【知识点】极限/导数/积分/...

【难度】简单/中等/困难

【题目】
（题目内容，如果图片已包含可省略）

【答案】
（答案内容）

【解析】
（详细解题步骤）

【注意事项】
（易错点、关键步骤提示等）
```

---

## 🛠️ 使用脚本工具

项目提供了多个辅助脚本，位于 `scripts/` 目录。

### 1. 交互式添加题目

```powershell
cd D:\桌面\HW\photo-search-questions
.venv\Scripts\python.exe scripts\add_question_interactive.py
```

按提示输入：
- 学科类型
- 题目图片路径
- 答案内容
- 知识点标签

### 2. 批量导入题目

```powershell
.venv\Scripts\python.exe scripts\import_questions.py "题库文件夹路径"
```

要求文件夹结构：
```
题库文件夹/
├── 题目1.jpg
├── 题目1.txt
├── 题目2.jpg
└── 题目2.txt
```

### 3. 测试系统

```powershell
.venv\Scripts\python.exe scripts\test_system.py
```

功能：
- 检查所有题目图片是否存在
- 检查所有答案文件是否存在
- 验证文件命名是否规范
- 生成题库统计报告

---

## ❓ 常见问题

### Q1: 题目添加后搜索不到？

**可能原因：**
1. 答案文件名与图片文件名不匹配
2. 文件编码不是 UTF-8
3. 服务器未重启

**解决方案：**
```powershell
# 检查文件名是否一致（不包含扩展名的部分）
photo/calc_001.jpg  ←→  data/answers/calc_001.txt

# 确保答案文件是UTF-8编码
# 用记事本打开 → 另存为 → 编码选择"UTF-8"

# 重启服务器
双击 "启动服务器.bat"
```

---

### Q2: 如何批量重命名文件？

**使用PowerShell批量重命名：**

```powershell
# 进入图片目录
cd D:\桌面\HW\photo-search-questions\photo

# 批量重命名为规范格式（示例：calc_001, calc_002...）
$i = 1
Get-ChildItem *.jpg | ForEach-Object {
    $newName = "calc_{0:D3}.jpg" -f $i
    Rename-Item $_.Name $newName
    $i++
}
```

---

### Q3: 答案中的数学公式如何显示？

系统支持 LaTeX 数学公式：

```text
行内公式：$f(x) = x^2$
块级公式：
$$
\int_0^1 x^2 dx = \frac{1}{3}
$$
```

常用符号：
- 分数：`\frac{分子}{分母}`
- 积分：`\int_下限^上限`
- 求和：`\sum_{i=1}^{n}`
- 极限：`\lim_{x \to 0}`
- 根号：`\sqrt{x}` 或 `\sqrt[n]{x}`

---

### Q4: 如何添加图片中没有的题目？

如果题目是纯文字：

```text
在答案文件中添加【题目】部分：

【题目】
设函数 f(x) = x³ - 3x + 1，求：
(1) f(x) 的极值点
(2) f(x) 在 [-2, 2] 上的最大值和最小值

【答案】
...
```

---

### Q5: 题库备份与导出

**备份题库：**
```powershell
# 压缩整个data目录
Compress-Archive -Path "D:\桌面\HW\photo-search-questions\data" -DestinationPath "题库备份_$(Get-Date -Format 'yyyyMMdd').zip"
```

**导出为Excel：**
```powershell
cd D:\桌面\HW\photo-search-questions
.venv\Scripts\python.exe scripts\export_to_excel.py
```

---

### Q6: 检查题库完整性

运行检查脚本：
```powershell
.venv\Scripts\python.exe scripts\test_system.py
```

输出报告：
```
✓ 题目总数: 50
✓ 答案文件完整: 50/50
✓ 图片文件完整: 50/50
✗ 缺失答案: 无
✗ 缺失图片: 无

学科分布：
- 高等数学: 20题
- 大学物理: 15题
- 电路分析: 15题
```

---

## 📊 题库管理最佳实践

### 1. 命名规范

✅ **推荐：**
```
calc_001.jpg    # 清晰、简洁
phys_002.jpg    # 学科明确
```

❌ **不推荐：**
```
题目1.jpg           # 无学科标识
高数-极限-1.jpg     # 中文、特殊字符
IMG_20250101.jpg    # 无意义命名
```

### 2. 文件组织

```
photo-search-questions/
├── photo/                    # 所有题目图片
│   ├── calc_001.jpg
│   ├── calc_002.jpg
│   └── phys_001.jpg
│
└── data/
    └── answers/              # 所有答案文件
        ├── calc_001.txt
        ├── calc_002.txt
        └── phys_001.txt
```

### 3. 版本控制

建议定期备份：
```powershell
# 每周备份一次
$date = Get-Date -Format "yyyyMMdd"
Compress-Archive -Path "photo","data" -DestinationPath "backup_$date.zip"
```

---

## 🎯 快速参考

| 操作 | 命令 |
|------|------|
| 添加单个题目 | 复制图片到 `photo/`，创建txt到 `data/answers/` |
| 批量导入 | `python scripts/import_questions.py 文件夹` |
| 检查完整性 | `python scripts/test_system.py` |
| 重启服务器 | 双击 `启动服务器.bat` |

---

## 📞 需要帮助？

- 查看示例：`data/answers/calc_001.txt`
- 运行测试：`python scripts/test_system.py`
- GitHub Issues: https://github.com/HJY147/hust-question-bank/issues

---

**祝你题库管理愉快！📚✨**
